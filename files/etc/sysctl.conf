# ================================================================
# TCP Congestion Control – High Throughput Focus
# ================================================================
# Use cubic for aggressive congestion window growth
net.ipv4.tcp_congestion_control = cubic

# ================================================================
# TCP Performance Tuning – Buffers and Queues
# ================================================================

# Maximize accept backlog for high concurrency
net.core.somaxconn = 65535
net.ipv4.tcp_max_syn_backlog = 65535

# Larger TCP read/write buffers for high-speed flows
net.core.rmem_default = 262144
net.core.rmem_max = 16777216
net.core.wmem_default = 262144
net.core.wmem_max = 16777216

# Reuse TIME_WAIT sockets for faster churn (especially for NAT)
net.ipv4.tcp_tw_reuse = 1

# Enable TCP Fast Open to reduce handshake latency
net.ipv4.tcp_fastopen = 3

# Allow TCP window scaling and modern extensions
net.ipv4.tcp_window_scaling = 1
net.ipv4.tcp_sack = 1
net.ipv4.tcp_dsack = 1
net.ipv4.tcp_timestamps = 1

# Enable aggressive Path MTU probing (avoid blackhole routes)
net.ipv4.tcp_mtu_probing = 2

# SYN flood protection
net.ipv4.tcp_syncookies = 1

# ================================================================
# Routing – If you’re a gateway
# ================================================================

# Enable IPv4 and IPv6 forwarding if acting as router/NAT/VPN gateway
net.ipv4.ip_forward = 1
net.ipv6.conf.all.forwarding = 1

# ================================================================
# Netfilter Conntrack Logging – Disable noisy invalid logging
# ================================================================
net.netfilter.nf_conntrack_log_invalid = 0

# ================================================================
# File Descriptors – Allow large connection tables
# ================================================================
fs.file-max = 100000
